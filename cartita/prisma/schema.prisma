generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id        Int      @id @default(autoincrement())
  nombre    String   @db.VarChar(255)
  email     String   @db.VarChar(255)
  password  String   @db.VarChar(255)
  rol       String   @db.VarChar(50)
  localId   Int?     @map("local_id")
  activo    Boolean  @default(true)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@unique([email, localId], name: "email_local_unique")
  @@index([email(length: 250)])
  @@index([localId], map: "usuarios_local_id_fkey")
  @@map("usuarios")
}

model Local {
  id              Int      @id @default(autoincrement())
  nombre          String   @db.VarChar(255)
  slug            String   @unique @db.VarChar(255)
  descripcion     String?  @db.Text
  direccion       String?  @db.VarChar(500)
  telefono        String?  @db.VarChar(50)
  email           String?  @db.VarChar(255)
  logoBase64      String?  @map("logo_base64") @db.LongText
  colorPrimario   String   @default("#FF6B35") @map("color_primario") @db.VarChar(7)
  colorSecundario String   @default("#004E89") @map("color_secundario") @db.VarChar(7)
  horarioAtencion String?  @map("horario_atencion") @db.LongText
  activo          Boolean  @default(true)
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  @@map("locales")
}

model Categoria {
  id          Int      @id @default(autoincrement())
  localId     Int      @map("local_id")
  nombre      String   @db.VarChar(255)
  descripcion String?  @db.Text
  icono       String?  @db.VarChar(50)
  orden       Int      @default(0)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@index([localId], map: "categorias_local_id_fkey")
  @@map("categorias")
}

model Producto {
  id                Int      @id @default(autoincrement())
  categoriaId       Int      @map("categoria_id")
  localId           Int      @map("local_id")
  nombre            String   @db.VarChar(255)
  descripcion       String?  @db.Text
  precio            Decimal  @db.Decimal(10, 2)
  imagenBase64      String?  @map("imagen_base64") @db.LongText
  tiempoPreparacion Int?     @map("tiempo_preparacion")
  disponible        Boolean  @default(true)
  destacado         Boolean  @default(false)
  opciones          String?  @db.LongText
  orden             Int      @default(0)
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")

  @@index([categoriaId], map: "productos_categoria_id_fkey")
  @@index([localId], map: "productos_local_id_fkey")
  @@map("productos")
}

model Pedido {
  id              Int      @id @default(autoincrement())
  localId         Int      @map("local_id")
  numeroPedido    Int      @map("numero_pedido")
  nombreCliente   String   @map("nombre_cliente") @db.VarChar(255)
  telefonoCliente String   @map("telefono_cliente") @db.VarChar(50)
  tipoEntrega     String   @map("tipo_entrega") @db.VarChar(50)
  direccion       String?  @db.VarChar(500)
  numeroMesa      String?  @map("numero_mesa") @db.VarChar(20)
  total           Decimal  @db.Decimal(10, 2)
  notas           String?  @db.Text
  estado          String   @default("pendiente") @db.VarChar(50)
  metodoPago      String?  @map("metodo_pago") @db.VarChar(50)
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  @@index([localId], map: "pedidos_local_id_fkey")
  @@map("pedidos")
}

model PedidoItem {
  id                Int      @id @default(autoincrement())
  pedidoId          Int      @map("pedido_id")
  productoId        Int      @map("producto_id")
  cantidad          Int
  precioUnitario    Decimal  @map("precio_unitario") @db.Decimal(10, 2)
  subtotal          Decimal  @db.Decimal(10, 2)
  personalizaciones String?  @db.LongText
  notas             String?  @db.Text
  createdAt         DateTime @default(now()) @map("created_at")

  @@index([pedidoId], map: "pedido_items_pedido_id_fkey")
  @@index([productoId], map: "pedido_items_producto_id_fkey")
  @@map("pedido_items")
}

model Solicitud {
  id             Int      @id @default(autoincrement())
  nombreNegocio  String   @map("nombre_negocio") @db.VarChar(255)
  nombreContacto String   @map("nombre_contacto") @db.VarChar(255)
  email          String   @db.VarChar(255)
  telefono       String?  @db.VarChar(50)
  tipoNegocio    String?  @map("tipo_negocio") @db.VarChar(100)
  mensaje        String?  @db.Text
  estado         String   @default("pendiente") @db.VarChar(50)
  createdAt      DateTime @default(now()) @map("created_at")

  @@map("solicitudes")
}

model Invitacion {
  id        Int      @id @default(autoincrement())
  localId   Int?     @map("local_id")
  token     String   @unique @db.VarChar(255)
  email     String?  @db.VarChar(255)
  rol       String   @db.VarChar(50)
  usado     Boolean  @default(false)
  expiraEn  DateTime @map("expira_en")
  createdAt DateTime @default(now()) @map("created_at")

  @@map("invitaciones")
}

model PasswordReset {
  id        Int      @id @default(autoincrement())
  usuarioId Int      @map("usuario_id")
  token     String   @unique @db.VarChar(255)
  usado     Boolean  @default(false)
  expiraEn  DateTime @map("expira_en")
  createdAt DateTime @default(now()) @map("created_at")

  @@index([usuarioId], map: "password_resets_usuario_id_fkey")
  @@map("password_resets")
}

model ConfiguracionGlobal {
  id                   Int       @id @default(autoincrement())
  mantenimientoActivo  Boolean   @default(false) @map("mantenimiento_activo")
  mantenimientoMensaje String?   @map("mantenimiento_mensaje") @db.Text
  mantenimientoFecha   DateTime? @map("mantenimiento_fecha")
  createdAt            DateTime  @default(now()) @map("created_at")
  updatedAt            DateTime  @updatedAt @map("updated_at")

  @@map("configuracion_global")
}
